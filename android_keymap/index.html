<!DOCTYPE html>
<html>
<head>
<style>
.row{
	display:block;
}
.key{
	display:inline-block;
	height:2em;
	box-shadow:0 0 1px inset;
	text-align: center;
	border-radius:3px;
}
.key:hover{
	box-shadow:0 0 1px 1px inset;
	cursor:pointer;
}
.key:active,.key:focus{
	box-shadow:0 0 1px 1px inset;
	background:rgba(0,0,0,0.1);
}
.filled{
}
.empty{
	visibility: hidden;
}
</style>
</head>
<body>
<h1>ScanCode Layout :</h1>
<div>
	<select onchange="layout.value=this.value;layout.onkeyup();">
	<option value="">Blank</option>
	<option value="1 _ 59 60 61 62 _:.5 63 64 65 66 _:.5 67 68 69 70 _ 70 70 70
_
41       2  3  4  5  6  7  8  9 10 11 12 13 14:2   _ 210 199 201 _ 69 181 55 74
15:1.5  16 17 18 19 20 21 22 23 24 25 26 27 28:1.5 _ 211 297 209 _ 71 72 73 78
58:1.75 30 31 32 33 34 35 36 37 38 39 40   28:2.25 _  _   _   _  _ 75 76 77 78
42:1.25 43 44 45 46 47 48 49 50 51 52 53   54:2.75 _  _  200  _  _ 79 80 81 156
29:1.25 221 219 56        57:7.75 184 220 157      _ 203 208 295 _ 82:2  83 156"
>100 Keys</option>
	<option value="1 59 60 61 62 63 64 65 66 67 68 69 70 110 211
_
41 2 3 4 5 6 7 8 9 10 11 12 13 14:2
15:1.5 16 17 18 19 20 21 22 23 24 25 26 27 28:1.5
58:1.75 30 31 32 33 34 35 36 37 38 39 40 28:2.25
32:1.25 43 44 45 46 47 48 49 50 51 52 53 54:2.75
29:1.25 221 219 56 57:3.75 184 220 157 203 200 208 295">87 Keys</option>
	<option value="41 2 3 4 5 6 7 8 9 10 11 12 13 14:2
15:1.5 16 17 18 19 20 21 22 23 24 25 26 27 28:1.5
58:1.75 30 31 32 33 34 35 36 37 38 39 40 28:2.25
32:1.25 43 44 45 46 47 48 49 50 51 52 53 54:2.75
29:1.25 221 219 56 57:3.75 184 220 157 203 200 208 295">60 Keys</option>
<option value="9:1.5 65 90 69 82 84 89 85 73 79 80 13:1.5
20:1.75 81 83 68 70 71 72 74 75 76 13:2.25
86:2.25 87 88 67 86 66 78 188 59 59 59:1.75
17:1.25 91:1.25 18 32:7 18:1.25 93:1.25">40 Keys</option>
	</select>
</div>
<div>
	<textarea id="layout" cols="80" rows="6" onkeyup="kb.innerHTML=printHTML(parseText(this.value))"></textarea>
</div>
<h1>Preview :</h1>
<div id="kb"></div>

<button onclick="alert(getfile_kl(parseText(layout.value)))">get .kl file</button>

<h1>Character Map :</h1>
<select id="kb_type">
	<option title="contain all the letters, and all the numbers">FULL</option>
	<option title="contain all the letters, and maybe some numbers">ALPHA</option>
	<option title="contain all the letters, but with more than one letter per key">PREDICTIVE</option>
	<option title="supports text entry using a multi-tap approach">NUMERIC</option>
	<option title="used to perform system control functions">SPECIAL_FUNCTION</option>
</select>

<h2 id="key_value_title">Click on a key ...</h2>
<div id="key_value">
	<select>
		<option title="label physically printed on the key">label</option>
		<option title="Applies when a numeric text view has focus">base</option>
		<option title="Applies when no modifiers are pressed">number</option>
		<option>shift</option>
		<option>lshift</option>
		<option>rshift</option>
		<option>alt</option>
		<option>lalt</option>
		<option>ralt</option>
		<option>ctrl</option>
		<option>lctrl</option>
		<option>rctrl</option>
		<option>meta</option>
		<option>lmeta</option>
		<option>rmeta</option>
		<option>sym</option>
		<option>fn</option>
		<option>capslock</option>
		<option>numlock</option>
		<option>scrolllock</option>
	</select>

	<select><script>
	var keys=['\\t','\\r','\\n'];
	for(var i=32;i<127;i++)keys.push(String.fromCharCode(i));
	document.write(
	 '<optgroup value ="\'" label="ASCII">'+keys.map(function(a){return "<option>"+a+"</option>"}).join('')+'</optgroup>'
	+'<optgroup value ="\'" label="Unicode" ><option onclick="this.value=this.innerHTML=\'\\\\u\'+prompt(\' (4 hex)\')">\\uXXXX</option></optgroup>'
	+'<optgroup value ="" label="fallback"><option>test</option></optgroup>'
	);
	//.replace(/([\\'"])/,'\\$1')
	</script></select>
</div>

<button onclick="alert(getfile_kcm(parseText(layout.value)))">get .kcm file</button>

<script>
//https://source.android.com/devices/tech/input/key-layout-files.html
//http://ibm.com/support/knowledgecenter/api/content/ssw_aix_71/com.ibm.aix.keyboardtechref/doc/kybdtech/Key.htm
//http://img.photobucket.com/albums/v493/Scraggle/scancode.jpg
//http://www.quadibloc.com/comp/scan.htm

function parseText(txt){
	return txt.split(/\n/).map(function(l){
		return l.split(/\s+/).map(function(a){
			return (a.match(/([_\d]+)(?:\:([\d\.]+))?/)||[]).slice(1)
		})
	})
}
function key_clicked(key){
	key_value_title.innerHTML="Key value for "+key+' :';
}
function printHTML(obj){
	return obj.map(function(l){return '<div class="row">'
		+l.map(function(a){if(!a||a[0]==undefined)return'';
			return '<a class="key '+(a[0]=='_'?'empty':'filled')+'" onclick="key_clicked(\''+a[0]+'\')" style="width:'+ ((a[1]||1)*2) +'em">'
				+a[0]+
				'</a>'}).join('')+
		'</div>'}).join('\n')
}

function getfile_kl(kb){
	var list=[];
	kb.forEach(function(row){row.forEach(function(key){if(!isNaN(key[0]))list[key[0]]="key "+key[0]+" CODE_"+key[0]+"\n"})});
	return list.sort(function(a,b){return -(a-b)}).map(function(a){return a}).join('');
}
function getfile_kcm(kb){
	var list=[];
	kb.forEach(function(row){row.forEach(function(key){if(!isNaN(key[0]))list[key[0]]="key CODE_"+key[0]+" {base:'x'}\n"})});
	return "type "+kb_type.value+"\n"+list.sort(function(a,b){return -(a-b)}).map(function(a){return a}).join('');
}
kb.innerHTML=printHTML(parseText(layout.value))
</script>
</body>
</html>
