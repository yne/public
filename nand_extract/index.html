<html>
<script>
function main(f){
	var reader = new FileReader();
	reader.onloadend = nandExtract[document.querySelector('#type').value];
	reader.readAsArrayBuffer(f);
}
var nand;
var nandExtract={
	PSP:function(file){
		nand = new Uint8Array(file.target.result),list="";
		for(var i=0;i<nand.length;i++){
			
			if(nand[i]==126 && nand[i+1]==80 && nand[i+2]==83 && nand[i+3]==80){//~PSP
				list+=prxExtract(nand,i);
			}
			if(nand[i]==0x00  && nand[i+1]==0x50 && nand[i+2]==0x52 && nand[i+3]==0x46){//.PRF 0x465250 00
				list+=rcoExtract(nand,i);
			}
		}
		document.getElementById('list').innerHTML=list;
	},
	PS3:function(file){
		nand = new Uint8Array(file.target.result),list="";
		for(var i=0;i<nand.length;i++){
			if(nand[i]==83 && nand[i+1]==67 && nand[i+2]==69 && nand[i+3]==0){//SCE\0
				list+=selfExtract(nand,i);
			}
		}
		document.getElementById('list').innerHTML=list;
	},
}
function extract(pos,size){
	var blob=new Blob([nand.subarray(pos,pos+size)]);
	var blobURL=URL.createObjectURL(blob);
	location.href=blobURL;
	URL.revokeObjectURL(blobURL);
}
//see http://hitmen.c02.at/files/yapspd/psp_doc/chap26.html#sec26.5
function prxExtract(array,pos){
	for(var name="",i=pos+10;array[i];name+=String.fromCharCode(array[i++]));
	for(var size=0 ,i=0;i<4;size+=array[pos+0x2C+i]<<8*i++);
	return '<tr>'+
			'<td><a download="lol" href="#" onclick="extract('+pos+','+size+')">'+name+'.prx</a></td>'+
			'<td>'+size+'</td><td>0x'+pos.toString(16)+'</td>'+
		'</tr>';
}
function rcoExtract(array,pos){
	var name="?";
	var size=0;
//	for(var name="",i=pos+10;array[i];name+=String.fromCharCode(array[i++]));
//	for(var size=0 ,i=0;i<4;size+=array[pos+0x2C+i]<<8*i++);
	return '<tr>'+
			'<td><a download="lol" href="#" onclick="extract('+pos+','+size+')">'+name+'.rco</a></td>'+
			'<td>'+size+'</td><td>0x'+pos.toString(16)+'</td>'+
		'</tr>';
}

function selfExtract(array,pos){
	ARRAY=array;
	POS=pos;
	var pos=pos;
	for(var size=0 ,i=7;i>0;size+=array[pos+20+i]<<8*(7-i--));
	var name="??";
	return '<tr>'+
			'<td><a download="lol" href="#" onclick="extract('+pos+','+size+')">'+name+'.prx</a></td>'+
			'<td>'+size+'</td><td>0x'+pos.toString(16)+'</td>'+
		'</tr>';
}

</script>
<body>
Nand Dump : <input type="file" onchange="main(event.target.files[0])"/>
Nand Type : <select id="type"><option>PS3<option>PSP</select>
<table>
	<thead><tr><th>Name</th><th>Size</th><th>Offset</th></tr></thead>
	<tbody id="list"></tbody>
</table>
</body>
</html>