<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<style>
@import url(http://fonts.googleapis.com/css?family=Gloria+Hallelujah);
*{
	-moz-transition:-moz-transform .15s linear;
	-o-transition:-o-transform .15s linear;
	-webkit-transition:-webkit-transform .15s linear;
}
body {
	font-family: "Lucida Grande", Verdana;
}
a{
	text-decoration:none;
	cursor: pointer;
}
#planning{
	background-color: #BF8748;
	background-image: url("chrome://browser/skin/newtab/noise.png"), url("chrome://browser/skin/newtab/noise.png");
	border: 10px ridge #BF8748;
	border-radius: 7px 7px 7px 7px;
	width: 100%;
}
#planning>thead{
}
#planning>thead th{
	box-shadow: 0 10px 10px -11px #000000;
	color: #FFF;
	height: 2em;
	text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
	width: 25%;
}
#planning>tbody>tr>td{
	vertical-align:top;
	padding-top: 20px;
}
.postitparent{
	display:inline-block;
}
.postit{
	cursor:move;
	background: #FEFABC;
	box-shadow: 0 4px 6px #333333;
	font-family: 'Gloria Hallelujah',cursive;
/*	max-width: 50px;*/
	overflow: hidden;
}
.postit:hover{
	z-index:999;
	transform: rotate(0deg) !important;
  transform: scale(2.25) !important;
}
.detail{
	display:none;
	font-family: "Lucida Grande",Verdana;
	font-size: 0.35em;
	position: fixed;
	top: -8px;
	left: 0;
	padding: 0;
}
.postit:hover .detail{
	display:inline;
}
.container{
	display:inline-block;
	border-collapse: collapse;
}
.container td{
	padding: 0 4px 0 4px;
}
.dragged{
	opacity:0.5;
}

</style>

<table id="planning">
<thead><tr></tr></thead>
<tbody><tr></tr></tbody>
</table>

<script>
var Postit={
	dragStart:function(e){
		Postit.target={};
		e.dataTransfer.effectAllowed = 'copy';
		e.dataTransfer.setData('id', this.id);
	},
	dragOver :function(e){
		if (e.preventDefault) e.preventDefault();
		e.dataTransfer.dropEffect = 'copy';
		Postit.target={
			id:this.parentNode.parentNode.parentNode.id,
			before:$(this).hasClass('left')
		};
	},
	drop:function(e){
		e.preventDefault();//eviter de se faire rediriger
		var $source=$('#'+e.dataTransfer.getData('id'));
		var $target=$('#'+Postit.target.id);
		if(Postit.target.before)
			$target.before($source);
		else
			$target.after($source);
		//TODO:ajax move record
			//on succed :
				//for each collumn
					//update postit id/class
	},
}
var collones = ["TODO","pending","done","tested"];
collones.forEach(function(title){//génere les pos-tits
	var formated = title.toLowerCase().replace(/\s/g,'');
	$('#planning>thead>tr').append('<th>'+title+'</th>');
	$('#planning>tbody>tr').append('<td id="'+formated+'"></td>');
	for(var i=0;i<10;i++){
		var rot=Math.round(25*(Math.random()-0.5));
		$('#'+formated).append(
			'<table id="postit_'+title+'_'+i+'" class="container" draggable="true">'+
			'<td class="spacer left"></td>'+
			'<td style="transform: rotate('+rot+'deg)" class="postit">'+
				'<a onclick="alert(\'TODO:\npopup : '+title+'_'+i+'\')">'+i+'</a>'+
			'</td>'+
			'<td class="spacer right"></td>'+
			'</table>'
		);
	}
})
//ajout du drag sur les postit et du drop sur les espaces
$('.spacer').each(function(e){
	this.addEventListener('dragover' , Postit.dragOver , false);
	this.addEventListener('drop'     , Postit.drop     , false);
})
$('.container').each(function(e){
	this.addEventListener('dragstart', Postit.dragStart, false);
})
</script>
